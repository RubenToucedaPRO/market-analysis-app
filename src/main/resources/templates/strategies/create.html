<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Strategy - AlphaSeeker</title>

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link th:href="@{/css/strategy-common.css}" rel="stylesheet" />
  </head>
  <body class="d-flex flex-column min-vh-100">
    <!-- Navigation Bar -->
    <nav
      class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm"
    >
      <div class="container-fluid">
        <!-- Logo and Title -->
        <a class="navbar-brand d-flex align-items-center" href="#">
          <i class="bi bi-graph-up-arrow text-primary fs-4 me-2"></i>
          <span class="fw-bold text-primary">AlphaSeeker</span>
        </a>

        <!-- Action Buttons -->
        <div class="d-flex gap-2">
          <a th:href="@{/strategies}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>
            Back to List
          </a>
          <button type="submit" form="strategyForm" class="btn btn-primary">
            <i class="bi bi-save me-1"></i>
            Save Strategy
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="container my-5 flex-grow-1">
      <h2 class="mb-4">Create New Strategy</h2>

      <form
        id="strategyForm"
        th:action="@{/strategies}"
        th:object="${strategy}"
        method="post"
      >
        <!-- Strategy Details Card -->
        <div class="card mb-4">
          <div class="card-header bg-light">
            <h5 class="mb-0">
              <i class="bi bi-gear text-primary me-2"></i>
              Strategy Details
            </h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <input type="hidden" th:field="*{id}" />
              <!-- Strategy Name -->
              <div class="col-md-6">
                <label for="strategyName" class="form-label fw-semibold"
                  >Strategy Name</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="strategyName"
                  th:field="*{name}"
                  placeholder="e.g., RSI Oversold Recovery"
                  required
                />
              </div>

              <!-- Description -->
              <div class="col-md-6">
                <label for="strategyDescription" class="form-label fw-semibold"
                  >Description</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="strategyDescription"
                  th:field="*{description}"
                  placeholder="Describe your strategy logic..."
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Execution Rules Card -->
        <div class="card">
          <div class="card-header bg-light">
            <h5 class="mb-0">
              <i class="bi bi-list-check text-primary me-2"></i>
              Execution Rules
            </h5>
          </div>
          <div class="card-body">
            <div id="rules-container">
              <!-- Existing rules will be rendered here -->
              <th:block th:each="rule, stat : *{rules}">
                <div
                  th:replace="~{fragments/rule-row :: ruleRow(index=${stat.index}, rule=${rule})}"
                ></div>
              </th:block>
            </div>
          </div>

          <!-- Add Rule Button -->
          <button
            type="button"
            class="btn btn-outline-primary w-100"
            onclick="addRuleRow()"
          >
            <i class="bi bi-plus-circle me-1"></i>
            Add Conditional Rule
          </button>
        </div>
      </form>
    </main>

    <!-- Footer -->
    <footer class="bg-light border-top py-3 mt-auto">
      <div class="container text-center">
        <small class="text-muted"
          >&copy; 2023 AlphaSeeker. All rights reserved.</small
        >
      </div>
    </footer>

    <template id="rule-template">
      <div
        th:replace="~{fragments/rule-row :: ruleRow(index=999, rule=${null})}"
      ></div>
    </template>

    <!-- Bootstrap 5 JS Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Pass rule definitions to JavaScript -->
    <script th:inline="javascript">
      window.ruleDefinitions = /*[[${ruleDefinitions}]]*/ [];
    </script>

    <!-- Custom JavaScript -->
    <script th:src="@{/js/strategy-manager.js}"></script>
  </body>
</html>
